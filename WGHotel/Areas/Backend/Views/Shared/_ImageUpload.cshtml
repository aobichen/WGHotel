<div class="row" id="image-upload">
    <input type="hidden" id="imgkey" value="@ViewBag.ImgKey" />
    <div class="panel panel-primary">
        <div class="panel-heading" style="background-color:#fff;border:none;">
            <button type="button" class="btn btn-default" id="btnUpload">
                上傳
            </button>
            <div style="width:0;height:0;overflow:hidden">
                <input type="file" name="file[]" id="file" multiple />
            </div>
        </div>
        <div class="panel-body" style="background-color:#fff;border:none;">
            <div class="row" id="image-panel">

            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    jQuery(function(){

        let btnupload = $('#btnUpload', '#image-upload');
        let file = $('#file','#image-upload');
        let imgPanel = $('#image-panel', '#image-upload');
        let key = $('#imgkey', '#image-upload').val();
   
        btnupload.on('click', function () {
            file.trigger('click');
        });

        file.on('change', function (e) {        
            preview(this);
            filesUpload(this.files);
        });

        function format_float(num, pos)
        {
            var size = Math.pow(10, pos);
            return Math.round(num * size) / size;
        }
 
        function preview(input) {
       
            if (input.files && input.files[0]) {
                var files = input.files;
                $.each(files, function (index, file) {          
                    var reader = new FileReader();          
                    reader.onload = function (e) {               
                        let col = $('<div class="col-md-3"></div>');
                        let imageTemp = $('<img/>').attr('src', e.target.result).addClass('img-responsive');
                        col.append(imageTemp);
                        imgPanel.append(col);
                        //var KB = format_float(e.total / 1024, 2);
                
                        //$('.size').text("檔案大小：" + KB + " KB");
                    }
 
                    reader.readAsDataURL(file);
                });
            }
        }

        function filesUpload(files) {
            var formData = new FormData();

            if (files.length > 0) {
                for (var i = 0, max = files.length; i < max; i++) {
                    formData.append("files" + i, files[i]);
                }

                formData.append("key", key);

                $.ajax({
                    type: "POST",
                    url: '/ImageUpload',
                    data: formData,
                    contentType: false,
                    processData: false,
                    success: function (xhr) {
                    },
                    error: function (xhr) {
                        console.log("ERROR");
                    }
                });
            }
        };

       

           
    })
    

</script>
